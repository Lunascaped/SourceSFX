const ADAPTATION_TABLE=[230,230,230,230,307,409,512,614,768,614,512,409,307,230,230,230];function clamp(t,e,n){return t<e?e:t>n?n:t}function expandNibble(t,e,n){const i=8<=t?t-16:t;let o=(e.sample1[n]*e.coeff1[n]+e.sample2[n]*e.coeff2[n]>>8)+i*e.delta[n];return o=clamp(o,-32768,32767),e.sample2[n]=e.sample1[n],e.sample1[n]=o,e.delta[n]=Math.floor(ADAPTATION_TABLE[t]*e.delta[n]/256),e.delta[n]<16&&(e.delta[n]=16),o}function decode(t,e,n,i){const o=t instanceof Uint8Array?t:new Uint8Array(t),l=new DataView(o.buffer,o.byteOffset,o.byteLength),r={coefficient:[n,i],coeff1:[],coeff2:[],delta:[],sample1:[],sample2:[]};let a=0;for(let t=0;t<e;t++){const e=clamp(o[a],0,6);a+=1,r.coeff1[t]=r.coefficient[0][e],r.coeff2[t]=r.coefficient[1][e]}for(let t=0;t<e;t++)r.delta.push(l.getInt16(a,!0)),a+=2;for(let t=0;t<e;t++)r.sample1.push(l.getInt16(a,!0)),a+=2;for(let t=0;t<e;t++)r.sample2.push(l.getInt16(a,!0)),a+=2;const f=[];for(let t=0;t<e;t++)f[t]=[r.sample2[t],r.sample1[t]];let s=0;for(;a<o.length;){const t=o[a];a+=1,f[s].push(expandNibble(t>>4,r,s)),s=(s+1)%e,f[s].push(expandNibble(15&t,r,s)),s=(s+1)%e}return f}function interleaveChannels(t){const e=t.length,n=t[0].length,i=new Int16Array(e*n);for(let o=0;o<n;o++)for(let n=0;n<e;n++)i[o*e+n]=t[n][o];return i}function createWavBlob(t,e,n){const i=n*e*16/8,o=16*e/8,l=2*t.length,r=new ArrayBuffer(44+l),a=new DataView(r),f=(t,e)=>{for(let n=0;n<e.length;n++)a.setUint8(t+n,e.charCodeAt(n))};f(0,"RIFF"),a.setUint32(4,36+l,!0),f(8,"WAVE"),f(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,e,!0),a.setUint32(24,n,!0),a.setUint32(28,i,!0),a.setUint16(32,o,!0),a.setUint16(34,16,!0),f(36,"data"),a.setUint32(40,l,!0);for(let e=0;e<t.length;e++)a.setInt16(44+2*e,t[e],!0);return new Blob([r],{type:"audio/wav"})}function decodeWavFile(t){const e=new DataView(t);let n=0;if("RIFF"!==String.fromCharCode(e.getUint8(n),e.getUint8(n+1),e.getUint8(n+2),e.getUint8(n+3)))throw new Error("Not a valid WAV file");n+=4;e.getUint32(n,!0);n+=4;if("WAVE"!==String.fromCharCode(e.getUint8(n),e.getUint8(n+1),e.getUint8(n+2),e.getUint8(n+3)))throw new Error("Not a valid WAV file");let i,o,l,r;n+=4;let a=[256,512,0,192,240,460,392],f=[0,-256,0,64,0,-208,-232],s=0,c=0;for(;n<t.byteLength;){const t=String.fromCharCode(e.getUint8(n),e.getUint8(n+1),e.getUint8(n+2),e.getUint8(n+3));n+=4;const d=e.getUint32(n,!0);if(n+=4,"fmt "===t){const t=e.getUint16(n,!0);if(i=e.getUint16(n+2,!0),o=e.getUint32(n+4,!0),l=e.getUint16(n+12,!0),r=e.getUint16(n+14,!0),2===t){if(e.getUint16(n+16,!0)>=32){if(7===e.getUint16(n+18+2,!0)){a=[],f=[];for(let t=0;t<7;t++)a.push(e.getInt16(n+18+4+4*t,!0)),f.push(e.getInt16(n+18+4+4*t+2,!0))}}}n+=d}else"data"===t?(s=n,c=d,n+=d):n+=d}if(!s||!i||!o)throw new Error("Invalid WAV file structure");const d=[];let g=s;const U=s+c;for(;g<U;){const e=Math.min(l,U-g),n=decode(new Uint8Array(t,g,e),i,a,f);if(0===d.length)for(let t=0;t<i;t++)d.push([]);for(let t=0;t<i;t++)d[t].push(...n[t]);g+=e}return createWavBlob(interleaveChannels(d),i,o)}export default decode;"undefined"!=typeof window&&(window.msadpcmDecode=decode,window.msadpcmDecodeWavFile=decodeWavFile);
//# sourceMappingURL=/js/sourcemaps/msadpcm.min.js.map